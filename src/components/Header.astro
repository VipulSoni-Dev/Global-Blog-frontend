---
import { SITE_TITLE } from '../consts';
import HeaderLink from './HeaderLink.astro';
---

<header>
  <nav>
    <h2 class="brand">
  		<a href="/">{SITE_TITLE} <span class="tagline">— Fresh perspectives, fast.</span></a>
    </h2>

    <!-- Backdrop for mobile -->
    <div class="backdrop" hidden></div>

    <!-- Drawer / Inline menu grouped with theme toggle on the right -->
    <div class="nav-right">
      <!-- Hamburger moved into right-side container so it sits at the far right on mobile -->
      <button class="hamburger" aria-expanded="false" aria-controls="menu" aria-label="Open menu">☰</button>
      <div id="menu" class="menu" aria-hidden="true">
        <button class="close" aria-label="Close menu">
          <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
        <HeaderLink href="/">Home</HeaderLink>
        <HeaderLink href="/blog">Blog</HeaderLink>
        <HeaderLink href="/about">About</HeaderLink>
        <!-- Theme toggle visible inside mobile drawer -->
        <button class="theme-toggle mobile-toggle" aria-label="Toggle color theme" title="Toggle theme">
          <span class="sr-only">Toggle theme</span>
          <svg class="icon icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" width="18" height="18" aria-hidden="true"><circle cx="12" cy="12" r="4"></circle><path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M4.93 19.07l1.41-1.41M17.66 6.34l1.41-1.41"/></svg>
          <svg class="icon icon-moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" width="18" height="18" aria-hidden="true"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path></svg>
        </button>
      </div>
      <button class="theme-toggle" aria-label="Toggle color theme" title="Toggle theme">
        <span class="sr-only">Toggle theme</span>
        <svg class="icon icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" width="18" height="18" aria-hidden="true"><circle cx="12" cy="12" r="4"></circle><path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M4.93 19.07l1.41-1.41M17.66 6.34l1.41-1.41"/></svg>
        <svg class="icon icon-moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" width="18" height="18" aria-hidden="true"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path></svg>
      </button>
    </div>
  </nav>
</header>

<script>
  const hd = document.querySelector('header');
  const onScroll = () => hd && hd.classList.toggle('is-stuck', window.scrollY > 12);
  onScroll(); addEventListener('scroll', onScroll, { passive: true });
</script>

<script>
  //@ts-ignore
  const btn = document.querySelector('.hamburger');
  //@ts-ignore
  const menu = document.getElementById('menu');
  //@ts-ignore
  const closeBtn = menu?.querySelector('.close');
  //@ts-ignore
  const backdrop = document.querySelector('.backdrop');
  
  
  const open = () => {
    document.body.classList.add('menu-open');
    //@ts-ignore
    btn.setAttribute('aria-expanded','true');
    //@ts-ignore
    menu.setAttribute('aria-hidden','false');
    //@ts-ignore
    backdrop.hidden = false;
    document.body.style.overflow = 'hidden';
    // focus first link
    //@ts-ignore
    const firstLink = menu.querySelector('a'); firstLink && firstLink.focus();
  };

  const close = () => {
    document.body.classList.remove('menu-open');
    //@ts-ignore
    btn.setAttribute('aria-expanded','false');
    //@ts-ignore
    menu.setAttribute('aria-hidden','true');
    document.body.style.overflow = '';
    // let the slide finish before hiding backdrop for click-through correctness
    //@ts-ignore
    setTimeout(()=>{ backdrop.hidden = true; }, 220);
    //@ts-ignore
    btn.focus();
  };
//@ts-ignore
  const toggle = () => (btn.getAttribute('aria-expanded') === 'true' ? close() : open());

  btn?.addEventListener('click', toggle);
  closeBtn?.addEventListener('click', close);
  backdrop?.addEventListener('click', close);
  document.addEventListener('keydown', e => { if (e.key === 'Escape') close(); });
  //@ts-ignore
  menu.querySelectorAll('a').forEach(a => a.addEventListener('click', close));

  // keep desktop inline; close drawer when crossing breakpoint
  const mq = window.matchMedia('(min-width: 768px)');
  //@ts-ignore
  const sync = e => { if (e.matches) close(); };
  sync(mq); mq.addEventListener('change', sync);
</script>

<script>
  // Theme toggle: persists in localStorage and respects prefers-color-scheme
  (function (){
    const KEY = 'theme';
    const root = document.documentElement;
    const buttons = Array.from(document.querySelectorAll('.theme-toggle'));
    //@ts-ignore
    function applyTheme(t){
      if(!t) return;
      root.setAttribute('data-theme', t);
      buttons.forEach(btn => {
        btn.setAttribute('aria-pressed', t === 'dark' ? 'true' : 'false');
      });
    }

    function getPreferred(){
      const saved = localStorage.getItem(KEY);
      if(saved === 'dark' || saved === 'light') return saved;
      return window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
    }

    function toggle(){
      const cur = root.getAttribute('data-theme') === 'dark' ? 'dark' : 'light';
      const next = cur === 'dark' ? 'light' : 'dark';
      localStorage.setItem(KEY, next);
      applyTheme(next);
    }

    // init
    const initial = getPreferred();
    applyTheme(initial);

    buttons.forEach(b => b.addEventListener('click', toggle));

    // keep in sync with OS changes when no explicit choice
    window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e=>{
      if(!localStorage.getItem(KEY)) applyTheme(e.matches ? 'dark' : 'light');
    });
  })();
</script>


<style>
  header {
    margin: 0;
    padding: 0 1em;
    background: var(--surface);
    box-shadow: 0 2px 8px rgba(var(--black), 5%);
  }
  h2 {
    margin: 0;
    font-size: 1em;
  }

  h2 a,
  h2 a.active {
    text-decoration: none;
  }
  nav {
    display: flex;
    align-items: center;
    justify-content: flex-start;
  }
  nav a {
    padding: 1em 0.5em;
    color: var(--black);
    border-bottom: 4px solid transparent;
    text-decoration: none;
  }
  nav a.active {
    text-decoration: none;
    border-bottom-color: var(--accent);
  }
  /* social-links removed */

  .theme-toggle{
    appearance: none; border: 0; background: transparent; font-size: 1.05rem; line-height:1;
    padding: .4rem .6rem; border-radius: .5rem; cursor:pointer; margin-left: .5rem; color: var(--text);
    height: 44px; display: inline-flex; align-items: center; justify-content: center;
    vertical-align: middle;
  }
  .theme-toggle:hover{ background: rgba(var(--gray), .04); }
  /* Right side container for desktop inline nav + controls */
  .nav-right{ display:flex; align-items:center; gap:1rem; margin-left: auto; }

  /* Icon visibility: show sun in light mode, moon in dark mode */
  .theme-toggle .icon-moon{ display:none; }
  .theme-toggle .icon-sun{ display:inline-block; }
  html[data-theme='dark'] .theme-toggle .icon-moon{ display:inline-block; }
  html[data-theme='dark'] .theme-toggle .icon-sun{ display:none; }

  /* Mobile: show the drawer's toggle and hide the right-header toggle to avoid duplication */
  .menu .theme-toggle{ display: none; }
  @media (max-width: 767px){
    .menu .theme-toggle{ display:inline-flex; margin-top: .75rem; }
    .nav-right > .theme-toggle{ display: none; }
  }
  /* Force exact centering in header row */
  .theme-toggle{ align-self: center; margin-top: 0; position: relative; top: 0; }
  @media (max-width: 720px) {
    /* no social icons */
  }

  /*======================================== mobile css ===============================*/
/* Base layout */
.nav{position:relative;display:flex;align-items:center;justify-content:space-between;padding:.75rem 1rem}
.brand a{font-weight:700;text-decoration:none}
.hamburger{background:none;border:0;font-size:1.6rem;line-height:1; padding:.25rem .5rem; border-radius:.5rem}

/* Backdrop */
.backdrop{
  position:fixed; inset:0; background:rgba(0,0,0,.0);
  opacity:0; transition:opacity .18s ease;
  z-index:999; pointer-events:none;
}

/* Drawer (mobile) / Inline (desktop) */
.menu{
  display:flex; align-items:flex-start; gap:.25rem; /* desktop defaults get overridden below */
}

/* Mobile drawer styles */
@media (max-width: 767px){
  .menu{
    position:fixed; top:0; right:0; bottom:0; width:min(80vw, 320px);
    background:var(--surface); box-shadow: -24px 0 48px rgba(0,0,0,.15);
    padding:1rem 1rem; display:flex; flex-direction:column; gap:.25rem;
    z-index:1000;
    transform:translateX(100%); opacity:.98;
    transition:transform .22s ease;
  }
  .menu a{
    display:block; width:100%; padding:.85rem 0; font-size:1.05rem;
    text-decoration:none; color:var(--text); border-radius:.75rem;
  }
  .menu a[aria-current="page"]{font-weight:700}
  .menu .close{
    align-self:flex-end;
    width:36px; height:36px; display:grid; place-items:center;
    background: transparent; border:1px solid rgba(var(--gray), .06);
    color: var(--text); border-radius:8px;
    font-size:18px; line-height:1; padding:0; margin-bottom:.75rem;
    cursor: pointer; z-index: 1101;
  }

  /* Ensure the close icon is clearly visible on both light and dark backgrounds */
  .menu .close svg{
    stroke: rgba(17,24,39,0.9); /* near-black for light mode */
    stroke-width: 2.6; /* slightly thicker for visibility */
    display:block;
  }
  /* Default: dark stroke for clarity on light button backgrounds */
  html[data-theme='dark'] .menu .close svg{
    /* Use dark stroke even in dark mode because the button will be light */
    stroke: rgba(17,24,39,0.95);
  }

  /* Dark-mode close button tweaks for contrast: use light button surface with dark icon */
  html[data-theme='dark'] .menu .close{
    border-color: rgba(0,0,0,0.06);
    background: rgba(255,255,255,0.96);
    color: rgba(17,24,39,0.95);
  }

  /* Light-mode close button tweaks */
  :not(html[data-theme='dark']) .menu .close{
    border-color: rgba(0,0,0,0.06);
    background: rgba(255,255,255,0.98);
    box-shadow: 0 1px 2px rgba(16,24,40,0.04);
  }

  /* Open state toggled by .is-open on body */
  body.menu-open .backdrop{opacity:1; background:rgba(0,0,0,.28); pointer-events:auto}
  body.menu-open .menu{transform:translateX(0)}
  /* social links removed */
}

/* Desktop inline nav */
@media (min-width: 768px){
  .hamburger, .backdrop, .menu .close{display:none}
  .menu{gap:1rem; align-items:center}
  .menu a{padding:1rem .5rem; border-bottom:4px solid transparent; text-decoration:none; color:var(--text)}
  .menu a[aria-current="page"]{border-bottom-color:var(--accent)}
}

/* Reduced motion */
@media (prefers-reduced-motion: reduce){
  .menu, .backdrop{transition:none}
}

@media (max-width: 480px) {
  header .site-title span.tagline {
    display: none;
  }
}

:root{
  --header-h: 56px;          /* mobile header height */
  --header-h-lg: 72px;       /* desktop header height */
  --pad-x: 14px;             /* horizontal padding */
  --ring: 0 1px 0 rgba(0,0,0,.06);      /* bottom divider */
  --shadow: 0 6px 24px rgba(0,0,0,.06); /* sticky shadow */
}

/* Header wrapper */
header{
  position: sticky; top: 0; z-index: 100;
  background:var(--surface);
  box-shadow: var(--ring);
  /* padding: 0;  /*height handled on .nav */
}

/* Main bar */
.nav{
  min-height: var(--header-h);
  display:flex; align-items:center; justify-content:space-between;
  padding-inline: var(--pad-x);
  gap: .75rem;
}

/* Brand: single line on mobile, no wrap */
.brand{ margin:0; line-height:1; }
.brand a{
  display:block;
  font-weight: 800;
  font-size: clamp(1rem, 3.2vw, 1.25rem);
  text-decoration:none; color:var(--text);
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
  max-width: calc(100vw - 160px); /* prevent collision with hamburger */
}

/* Hamburger: comfy 44px target, visually ~24–28px icon */
.hamburger{
  background:transparent; border:0; color:var(--text);
  width:44px; height:44px; border-radius:10px;
  font-size: 22px; line-height:1; display:grid; place-items:center;
}
.hamburger:focus-visible{ outline: 2px solid #4f46e5; outline-offset:2px; }
.hamburger:hover{ background: rgba(var(--gray), .04); }

/* Hide social icons on small screens */
@media (max-width: 767px){ .social-links{ display:none; } }

/* Desktop size bumps */
@media (min-width: 768px){
  .nav{ min-height: var(--header-h-lg); padding-inline: 24px; }
  .brand a{ font-size: clamp(1.1rem, 1.2vw, 1.35rem); max-width: none; }
  .hamburger{ display:none; }
}

/* When page scrolls a bit, add a soft shadow to separate from content (optional) */
@supports (backdrop-filter: blur(6px)){



</style>
